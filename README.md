# SOQOL-онлайн

Веб-приложение SOQOL Онлайн позволяет выполнять SQL-запросы к пользовательским базам данных SOQOL. 
Выбор любой версии сервера СУБД Сокол, создание отдельной базы для пользователя и назначение ему в ней роли DBA позволяют выполнять большое множество запросов,
необходимых в реальных приложениях баз данных.
Возможность создания нескольких пользователей в своей базе дает возможность увидеть, как наличие тех или иных системных и объектных привилегий влияет на его доступ к объектам различных схем БД.

## Как предоставить веб-приложению доступ к новому серверу БД
Для предоставления веб-приложению возможности подключения к серверу баз данных, создания на нем пользовательских баз данных и их удаления необходимо:
- В каталог src/main/docker/distr добавить подкаталог, содержащий распакованный дистрибутив, конфигурационный файл сервера, а также Dockerfile с указанием порта, на котором будет запущен сервер.
- В файл src/main/docker/docker-compose.yml добавить описание сервиса, соответствующего новой версии. В этом же docker-compose файле добавить в список зависимостей сервиса app имя нового soqol-сервиса.
- В каталог src/main/docker/app/drivers добавить каталог, содержащий jar-файл драйвера соответствующей версии.
- Добавить в application.yml описание конфигурации добавляемого сервера.


### О конфигурации сервера БД
 В файле application.yml хранятся параметры настройки всех серверов баз данных,
 к которым конечный пользователь может выполнить подключение. 
 Для каждого сервера БД, регистрируемого приложением, необходимо указание следующих параметров:
 - Полное название класса JDBC драйвера, необходимого для создания подключения и запросов к серверу в коде веб-приложения
 - Полный путь к jar-файлу, содержащему имплементацию интерфейса Driver для регистрируемого сервера, относительно директории ${DRIVERS_DIR}
 - Имя хоста и порт, на котором будет установлен сервер
 - Наименование версии сервера, отображаемое пользователям веб-сервиса


 ## Чем плоха текущая реализация веб-приложения SOQOL-онлайн:
- Пока что нет возможности работы с серверами других вендоров СУБД.
- Нет никакого отслеживания того, как потребляются базами такие ресурсы приложения, как память и диск.
- Не настроены политики рестарта контейнеров с серверами Сокола.
- Криво обрабатываются результаты SQL-запросов (парсинг текста скрипта учитывается только незакавыченный терминатор ";", такое условие парсинга не позволяет создавать хранимые процедуры с непустым блоком оператором).
- Методы контроллеров возвращают сразу представления, реализванные через Thymeleaf. Необходимо возвращать модель.
- Слишком сложная процедура добавления новой версии сервера БД + копипаст Dockerfile-ов, отличающихся лишь номеров EXPOSED-порта - необходимый единый Dockerfile для всех Сокол-контейнеров.
- Копипаст конфигурационного файла для каждой версии сервера БД с одной лишь переменной - номером порта.
- Некорректные URL-ы для подключения к базам серверов прод определенным пользователем; не соблюдается формат:
  - .../{server_version}/{db_id}?username={user}&password={userpassword} или
  - .../{server_version}?database={db_id}&username={user}&password={userpassword}
- Таймауты для обработки длинных запросов отсутствуют.
- Отсутствие тестов.
- Отсутствие нормальной обработки ошибок в приложении.
